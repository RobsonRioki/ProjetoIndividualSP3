<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Principal</title>
    <link rel="stylesheet" href="./css/cssgeral.css" />
    <link rel="stylesheet" href="./CSS/cssTelaPrincipal.css" />
    <link rel="icon" href="./assets/imgs/Japanfeedlogo.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Quicksand&display=swap"
      rel="stylesheet"
    />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
    <script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script>
    <script src="http://www.chartjs.org/samples/latest/utils.js"></script>
  </head>
  <body onload="puxar()">
    <header>
      <a href="./index.html" class="logobox">
        <div class="logo"></div>
      </a>
      <h3 class="h3Header" onclick="mudando('login')"><a>Login</a></h3>
    </header>

    <h1>Pratos típicos</h1>
    <div class="divImagensTextos">
      <img src="./assets/imgs/Okonomiyaki.png" alt="" class="imagem1" />
      <div class="divTextos">
        <h2>Okonomiyaki (Panqueca de repolho)</h2>
        <p>
          O nome parece complicado, mas ele é cheio de significados. Em japonês,
          okonomi significa “aquilo que você quiser”, e yaki quer dizer
          “grelhado” ou “frito”. Tudo isso para explicar toda a versatilidade
          deste prato tradicional, que pode ser preparado com o legume que
          desejar, no Japão é preparado de diversas maneiras diferentes,
          dependendo da região. Receita perfeita para um jantar mais leve!
        </p>
      </div>
    </div>

    <div class="divImagensTextos">
      <img src="./assets/imgs/takoyaki.jpg" alt="" class="imagem1" />
      <div class="divTextos">
        <h2>Takoyaki (Polvo frito)</h2>
        <p>
          Takoyaki é considerado o petisco magistral. No Japão, é um dos mais
          populares e é vendido em barracas de rua, é item que não pode faltar
          em festivais. é um popular bolinho redondo japonês que mais se parece
          com uma panqueca temperada feita com uma massa muito mole, quase
          líquida, e frita em uma chapa especial para Takoyaki. Normalmente é
          recheado com pedaços cortados ou um polvo pequeno inteiro, raspas de
          tempura (tenkasu), gengibre picado e cebolinha.
        </p>
      </div>
    </div>

    <div class="divImagensTextos">
      <img src="./assets/imgs/Omuraisu.jpg" alt="" class="imagem1" />
      <div class="divTextos">
        <h2>Omuraisu (Omelete com arroz)</h2>
        <p>
          Omuraisu ou Omurice é um prato ocidental que foi adaptado ao paladar
          japonês. É um prato muito popular no Japão, Coreia e Taiwan e consiste
          em Omelete com arroz frito com cobertura de ketchup. O proprietário
          disse que a ideia surgiu a partir de uma receita antiga de
          Chakin-Zushi (arroz de sushi enrolado em uma folha fina de omelete). O
          recheio do Omuraisu pode variar conforme a receita, mas normalmente
          consiste no Raisu Chikin (arroz com pedaços de frango e temperos), mas
          pode ser usado outros tipos de carnes, vegetais e outros ingredientes
          em seu preparo.
        </p>
      </div>
    </div>

    <div class="divImagensTextos">
      <img src="./assets/imgs/karaague.jpg" alt="" class="imagem1" />
      <div class="divTextos">
        <h2>Karaage (Frango frito japonês)</h2>
        <p>
          Karaage é o nome dado ao Frango Frito Japonês, amplamente consumido no
          Japão. Embora se assemelhe com frango milanesa, o Karaage é diferente,
          sendo altamente crocante por fora e macio por dentro. O sabor também o
          difere de um frango milanesa tradicional devido aos ingredientes
          adicionados. O que dá um sabor especial ao Karaage é o tempero onde
          estão incluídos alho, gengibre, saquê e shoyu. Neste tempero, o frango
          ficará marinando por meia hora. Já a casquinha crocante e dourada se
          dá por conta do amido de milho ou fécula de batata (pode ser um dos
          dois) que envolverá o frango, que em seguida é frito em óleo vegetal.
          Embora a receita mais comum seja de frango, é possível utilizar outra
          carne como peixe.
        </p>
      </div>
    </div>
    <div class="divImagensTextos">
      <img src="./assets/imgs/lamen.jpg" alt="" class="imagem1" />
      <div class="divTextos">
        <h2>Lámen</h2>
        <p>
          O lámen (rāmen, em japonês) é uma deliciosa combinação de sopa e
          macarrão, uma receita clássica que surgiu na China e foi desenvolvida
          no Japão, ganhando fama (e os paladares) do resto do mundo. O caldo
          lámen pode ser feito com carne de porco, de boi, de frango ou até
          vegetariano, agradando todo os gostos.
        </p>
      </div>
    </div>
    <div class="divImagensTextos">
      <img src="./assets/imgs/sushi.jpg" alt="" class="imagem1" />
      <div class="divTextos">
        <h2>Sushi</h2>
        <p>
          O sushi é com certeza a comida japonesa mais famosa no mundo,
          conhecido por ser composto por arroz, nori, que é uma espécie de folha
          feita com algas marinhas, e um recheio variado – peixe cru, peixe
          grelhado e, ainda, legumes, doces e muito mais.
        </p>
      </div>
    </div>

    <h2>Avalie os pratos:</h2>
    <div class="divAvaliacao">
      <div class="divAvaliacaoUnica">
        <p>Okonomiyaki:</p>
      </div>
      <input
        class="inputSelecaoAvaliacao"
        type="Number"
        min="0"
        max="10"
        id="input_avaliacao1"
      />

      <div class="divAvaliacaoUnica">
        <p>Takoyaki:</p>
      </div>
      <input
        class="inputSelecaoAvaliacao"
        type="Number"
        min="0"
        max="10"
        id="input_avaliacao2"
      />

      <div class="divAvaliacaoUnica">
        <p>Omuraisu:</p>
      </div>
      <input
        class="inputSelecaoAvaliacao"
        type="Number"
        min="0"
        max="10"
        id="input_avaliacao3"
      />

      <div class="divAvaliacaoUnica">
        <p>Karaague:</p>
      </div>
      <input
        class="inputSelecaoAvaliacao"
        type="Number"
        min="0"
        max="10"
        id="input_avaliacao4"
      />

      <div class="divAvaliacaoUnica">
        <p>Lámen:</p>
      </div>
      <input
        class="inputSelecaoAvaliacao"
        type="Number"
        min="0"
        max="10"
        id="input_avaliacao5"
      />

      <div class="divAvaliacaoUnica">
        <p>Sushi:</p>
      </div>
      <input
        class="inputSelecaoAvaliacao"
        type="Number"
        min="0"
        max="10"
        id="input_avaliacao6"
      />
      <button class="botaoAvaliacao" onclick="avaliar()">Enviar</button>
    </div>

    <div class="redirecionador">
      <h3>
        <a href="questionario.html"
          >Faça aqui um quiz sobre a culinária japonesa</a
        >
      </h3>
    </div>
    <section class="dashboards">
      <canvas id="Quest1"></canvas>
    </section>

    <section class="dashboards">
      <canvas id="Quest2"></canvas>
    </section>

    <section class="dashboards">
      <canvas id="Quest3"></canvas>
    </section>

    <footer>
      <div class="tudo">
        <a
          href="https://wa.me/+5511986090189/? text="
          target="https://wa.me/+5511986090189/? text="
        >
          <img class="icone" src="./assets/imgs/whatsapp.png" alt="" />
        </a>
        <a href="https://www.sptech.school" target="https://www.sptech.school">
          <img class="icone" src="./assets/imgs/sptech.png" alt="" />
        </a>
        <a
          href="https://github.com/RobsonRioki"
          target="https://github.com/RobsonRioki"
        >
          <img class="icone" src="./assets/imgs/github.png" alt=""
        /></a>
      </div>
    </footer>
  </body>
</html>
<script>
  const valoresQuestao1 = [];
  const valoresQuestao2 = [];
  const valoresQuestao3 = [];

  function puxar() {
    // alert("asdasd");

    fetch("/questionario/dados", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
    })
      .then(function (resposta) {
        console.log("ESTOU NO THEN DO entrar()!");

        if (resposta.ok) {
          console.log(resposta);

          resposta.json().then((json) => {
            console.log(json);
            console.log(JSON.stringify(json));
            // alert(json.LamenResp);
            valoresQuestao1.push(json.LamenResp);
            valoresQuestao1.push(json.OkonomiyakiResp);
            valoresQuestao1.push(json.OmuraisuResp);
            valoresQuestao1.push(json.TakoyakiResp);
            valoresQuestao1.push(json.KaraagueResp);
            valoresQuestao1.push(json.SushiResp);
            valoresQuestao2.push(json.GostoResp);
            valoresQuestao2.push(json.NuncaExpeResp);
            valoresQuestao2.push(json.NGostoResp);
            valoresQuestao3.push(json.ComeriaResp);
            valoresQuestao3.push(json.ExperimentariaResp);
            valoresQuestao3.push(json.NãoComeriaResp);
            // alert(json.idAvaliacao + "asldjnasldnaosndoasijdopasbndpo");
            carregarGraficos();
          });
        } else {
          console.log("Houve um erro ao tentar realizar o login!");

          resposta.text().then((texto) => {
            console.error(texto);
            // finalizarAguardar(texto);
          });
        }
      })
      .catch(function (erro) {
        console.log(erro);
      });
    // console.log(fkAvaliacao);
  }

  function mudando(tela) {
    window.location.href = `${tela}.html`;
  }
  function redirecionar() {
    window.location.href = "questionario.html";
  }

  function avaliar() {
    var fkUsuario = sessionStorage.ID_USUARIO;

    var fkAvaliacao = "";

    // alert(fkUsuario);
    // return;

    var avaliacao1 = input_avaliacao1.value;
    var avaliacao2 = input_avaliacao2.value;
    var avaliacao3 = input_avaliacao3.value;
    var avaliacao4 = input_avaliacao4.value;
    var avaliacao5 = input_avaliacao5.value;
    var avaliacao6 = input_avaliacao6.value;

    if (
      avaliacao1 <= 10 &&
      avaliacao2 <= 10 &&
      avaliacao3 <= 10 &&
      avaliacao4 <= 10 &&
      avaliacao5 <= 10 &&
      avaliacao6 <= 10 &&
      avaliacao1 >= 0 &&
      avaliacao2 >= 0 &&
      avaliacao3 >= 0 &&
      avaliacao4 >= 0 &&
      avaliacao5 >= 0 &&
      avaliacao6 >= 0
    ) {
      // alert("Avaliação enviada");
      // Enviando o valor da nova input
      fetch("/avaliacao/autenticar", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          idUsario: fkUsuario,
        }),
      })
        .then(function (resposta) {
          console.log("ESTOU NO THEN DO entrar()!");

          if (resposta.ok) {
            console.log(resposta);

            resposta.json().then((json) => {
              console.log(json);
              console.log(JSON.stringify(json));

              if (fkAvaliacao.length > 0) {
                alert("Não pode fazer a avaliação 2 vezes");
                return;
              }
              // alert(json.idAvaliacao + "asldjnasldnaosndoasijdopasbndpo");
            });
          } else {
            console.log("Houve um erro ao tentar realizar o login!");

            resposta.text().then((texto) => {
              console.error(texto);
              // finalizarAguardar(texto);
            });
          }
        })
        .catch(function (erro) {
          console.log(erro);
        });
      console.log(fkAvaliacao);
      // alert(fkAvaliacao);
      // return;
      fetch(`/avaliacao/cadastrar`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          // crie um atributo que recebe o valor recuperado aqui
          // Agora vá para o arquivo routes/usuario.js
          avaliacao1Server: avaliacao1,
          avaliacao2Server: avaliacao2,
          avaliacao3Server: avaliacao3,
          avaliacao4Server: avaliacao4,
          avaliacao5Server: avaliacao5,
          avaliacao6Server: avaliacao6,
          fkUser: fkUsuario,
        }),
      })
        .then(function (resposta) {
          console.log("resposta: ", resposta);

          if (resposta.ok) {
            // cardErro.style.display = "block";

            alert("Avaliação enviada com sucesso...");
          } else {
            throw "Houve um erro ao tentar realizar o cadastro!";
          }
        })
        .catch(function (resposta) {
          console.log(`#ERRO: ${resposta}`);
        });

      return false;
    } else {
      alert("Avaliações inválidas. Por favor insira um número entre 0 e 10");
    }

    // function listar() {
    //   fetch("/empresas/listar", {
    //     method: "GET",
    //   })
    //     .then(function (resposta) {
    //       resposta.json().then((empresas) => {
    //         empresas.forEach((empresa) => {
    //           listaEmpresas.innerHTML += `<option value='${empresa.id}'>${empresa.cnpj}</option>`;
    //         });
    //       });
    //     })
    //     .catch(function (resposta) {
    //       console.log(`#ERRO: ${resposta}`);
    //     });
    // }

    function sumirMensagem() {
      cardErro.style.display = "none";
    }
  }

  function carregarGraficos() {
    // alert("asdasdasdaleo");
    var Grafico01 = document.getElementById("Quest1").getContext("2d");
    Grafico01.canvas.width = 500;
    Grafico01.canvas.height = 150;
    var graf1 = new Chart(Grafico01, {
      type: "bar",
      data: {
        labels: [
          "Lámen",
          "Okonomiyaki",
          "Omuraisu",
          "Takoyaki",
          "Karaague",
          "Sushi",
        ],
        datasets: [
          {
            label: "Dos pratos apresentados qual deles mais te interessa?",
            type: "bar",
            data: valoresQuestao1,
            backgroundColor: "RGB(255, 145, 77)",
          },
        ],
      },
      options: {
        scales: {
          xAxes: [
            {
              ticks: {
                beginAtZero: true,
              },
            },
          ],
          yAxes: [
            {
              ticks: {
                beginAtZero: true,
              },
            },
          ],
        },
      },
    });

    var Grafico02 = document.getElementById("Quest2").getContext("2d");
    Grafico02.canvas.width = 500;
    Grafico02.canvas.height = 150;
    var graf2 = new Chart(Grafico02, {
      type: "bar",
      data: {
        labels: ["Gosto", "Nunca experimentei", "Não gosto"],
        datasets: [
          {
            label: "Você gosta da culinária japonesa?",
            type: "bar",
            data: valoresQuestao2,
            backgroundColor: "RGB(255, 145, 77)",
          },
        ],
      },

      options: {
        scales: {
          xAxes: [
            {
              ticks: {
                beginAtZero: true,
              },
            },
          ],
          yAxes: [
            {
              ticks: {
                beginAtZero: true,
              },
            },
          ],
        },
      },
    });

    var Grafico03 = document.getElementById("Quest3").getContext("2d");
    Grafico03.canvas.width = 500;
    Grafico03.canvas.height = 150;
    var graf3 = new Chart(Grafico03, {
      type: "bar",
      data: {
        labels: ["Comeria", "Experimentaria", "Não comeria"],
        datasets: [
          {
            label: "Você comeria comidas cruas?",
            type: "bar",
            data: valoresQuestao3,
            backgroundColor: "RGB(255, 145, 77)",
          },
        ],
      },
      options: {
        scales: {
          xAxes: [
            {
              ticks: {
                beginAtZero: true,
              },
            },
          ],
          yAxes: [
            {
              ticks: {
                beginAtZero: true,
              },
            },
          ],
        },
      },
    });
  }
</script>
